// ----------------------------------------------------
// PRISMA SCHEMA COMPLETO
// ----------------------------------------------------

// 1. Configura√ß√£o do Data Source
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 2. Configura√ß√£o do Generator
generator client {
  provider = "prisma-client-js" 
}

// ENUMS DE FOCO E OBJETIVO
// ----------------------------------------------------

// 3. ENUM: Mapeando nosso Value Object (Objetivo do Usu√°rio)
enum GoalType {
  MASS_GAIN       
  WEIGHT_LOSS     
  MAINTENANCE     
}

// üö® NOVO ENUM: Define o tipo de foco do treino
enum WorkoutFocus {
  MASS_GAIN       
  WEIGHT_LOSS     
  MAINTENANCE     
}

// MODELOS DE AUTENTICA√á√ÉO E PERFIL
// ----------------------------------------------------

// 4. MODEL: Mapeando nossa Entidade (User)
model User {
  id               String       @id @default(uuid())
  firstName        String
  lastName         String?     
  dateOfBirth      DateTime
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt     
  email            String       @unique         
  passwordHash     String       
  goalType         GoalType  
  
  // Relacionamentos:
  workoutSessions  WorkoutSession[]

  // üö® CORRE√á√ÉO: Campo inverso para o relacionamento 1:1 com UserWorkout
  userWorkout      UserWorkout? 
  
  @@map("users")
}

// 5. Model: Sess√£o de Treino (Sessions)
model WorkoutSession {
  id               String    @id @default(uuid())
  startTime        DateTime  @default(now())
  endTime          DateTime?
  isCompleted      Boolean   @default(false)
  
  userId           String
  user             User      @relation(fields: [userId], references: [id])
  
  @@map("workout_sessions")
}

// MODELOS DE TREINAMENTO (CORE)
// ----------------------------------------------------

// 1. ENUM: MuscleGroup 
enum MuscleGroup {
  CHEST
  BACK
  LEGS
  SHOULDERS
  BICEPS
  TRICEPS
  CORE
}

model ExerciseAlternative {
  mainExerciseId     String
  alternativeId      String

  // Relacionamento com o exerc√≠cio principal
  mainExercise       Exercise @relation("MainAlternatives", fields: [mainExerciseId], references: [id])
  
  // Relacionamento com o exerc√≠cio que √© o alternativo
  alternative        Exercise @relation("AlternativeFor", fields: [alternativeId], references: [id])

  @@id([mainExerciseId, alternativeId])
  @@map("exercise_alternatives")
}

// 2. MODEL: Exercise (Agregado 'Exercicio')
model Exercise {
  id               String          @id @default(uuid())
  name             String
  gifUrl           String
  isBasic          Boolean         @default(false)

  targets          ExerciseMuscleTarget[]
  workoutItems     WorkoutItem[]
  mainAlternatives    ExerciseAlternative[] @relation("MainAlternatives")
  alternativeFor      ExerciseAlternative[] @relation("AlternativeFor")
  @@map("exercises")
}

// 3. TABELA DE LIGA√á√ÉO (MuscleGroup)
model ExerciseMuscleTarget {
  exerciseId       String
  muscleGroup      MuscleGroup 
  
  exercise         Exercise @relation(fields: [exerciseId], references: [id])
  
  @@id([exerciseId, muscleGroup]) 
  @@map("exercise_muscle_targets")
}


// 4. MODEL: Workout (Agregado 'Treino')
model Workout {
  id               String          @id @default(uuid())
  name             String          
  description      String
  
  // üö® NOVO CAMPO: Liga o Treino ao seu objetivo de foco
  focus            WorkoutFocus 
  
  items            WorkoutItem[]
  userWorkouts     UserWorkout[] 

  @@map("workouts")
}

// 5. MODEL: WorkoutItem (Entidade Aninhada)
model WorkoutItem {
  id               String          @id @default(uuid())
  order            Int             

  series           Int
  repetitions      Int
  restTimeSeconds  Int

  workoutId        String
  workout          Workout @relation(fields: [workoutId], references: [id])

  exerciseId       String
  exercise         Exercise @relation(fields: [exerciseId], references: [id])

  @@map("workout_items")
}

// 6. MODEL: Liga√ß√£o do Usu√°rio ao Treino (1:1)
model UserWorkout {
  id               String          @id @default(uuid())
  userId           String          @unique 
  workoutId        String
  isActive         Boolean         @default(true) 

  user             User      @relation(fields: [userId], references: [id])
  workout          Workout   @relation(fields: [workoutId], references: [id])

  @@map("user_workouts")
}